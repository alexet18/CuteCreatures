{"ast":null,"code":"import { BidiModule } from '@angular/cdk/bidi';\nimport * as i1 from '@angular/cdk/overlay';\nimport { OverlayConfig, ConnectionPositionPair, OverlayModule } from '@angular/cdk/overlay';\nimport * as i3 from '@angular/common';\nimport { DOCUMENT, CommonModule } from '@angular/common';\nimport * as i0 from '@angular/core';\nimport { Directive, Injectable, forwardRef, EventEmitter, TemplateRef, ElementRef, Component, ChangeDetectionStrategy, Optional, Inject, Input, Output, ViewChild, ViewChildren, ContentChild, NgModule } from '@angular/core';\nimport { NG_VALUE_ACCESSOR, FormsModule } from '@angular/forms';\nimport * as i4 from 'ng-zorro-antd/icon';\nimport { NzIconModule } from 'ng-zorro-antd/icon';\nimport { Subject, Observable, merge, fromEvent } from 'rxjs';\nimport { __decorate } from 'tslib';\nimport { ENTER, LEFT_ARROW, RIGHT_ARROW, TAB, ESCAPE, UP_ARROW, DOWN_ARROW } from '@angular/cdk/keycodes';\nimport { TemplatePortal } from '@angular/cdk/portal';\nimport { startWith, switchMap } from 'rxjs/operators';\nimport { DEFAULT_MENTION_BOTTOM_POSITIONS, DEFAULT_MENTION_TOP_POSITIONS } from 'ng-zorro-antd/core/overlay';\nimport { getMentions, getCaretCoordinates, InputBoolean } from 'ng-zorro-antd/core/util';\n/**\n * Use of this source code is governed by an MIT-style license that can be\n * found in the LICENSE file at https://github.com/NG-ZORRO/ng-zorro-antd/blob/master/LICENSE\n */\n\nconst _c0 = [\"items\"];\n\nfunction NzMentionComponent_ng_template_1_li_1_ng_container_2_ng_container_1_Template(rf, ctx) {\n  if (rf & 1) {\n    i0.ɵɵelementContainer(0);\n  }\n}\n\nconst _c1 = function (a0) {\n  return {\n    $implicit: a0\n  };\n};\n\nfunction NzMentionComponent_ng_template_1_li_1_ng_container_2_Template(rf, ctx) {\n  if (rf & 1) {\n    i0.ɵɵelementContainerStart(0);\n    i0.ɵɵtemplate(1, NzMentionComponent_ng_template_1_li_1_ng_container_2_ng_container_1_Template, 1, 0, \"ng-container\", 8);\n    i0.ɵɵelementContainerEnd();\n  }\n\n  if (rf & 2) {\n    const suggestion_r4 = i0.ɵɵnextContext().$implicit;\n    const ctx_r7 = i0.ɵɵnextContext(2);\n    i0.ɵɵadvance(1);\n    i0.ɵɵproperty(\"ngTemplateOutlet\", ctx_r7.suggestionTemplate)(\"ngTemplateOutletContext\", i0.ɵɵpureFunction1(2, _c1, suggestion_r4));\n  }\n}\n\nfunction NzMentionComponent_ng_template_1_li_1_ng_template_3_Template(rf, ctx) {\n  if (rf & 1) {\n    i0.ɵɵtext(0);\n  }\n\n  if (rf & 2) {\n    const suggestion_r4 = i0.ɵɵnextContext().$implicit;\n    const ctx_r9 = i0.ɵɵnextContext(2);\n    i0.ɵɵtextInterpolate(ctx_r9.nzValueWith(suggestion_r4));\n  }\n}\n\nfunction NzMentionComponent_ng_template_1_li_1_Template(rf, ctx) {\n  if (rf & 1) {\n    const _r14 = i0.ɵɵgetCurrentView();\n\n    i0.ɵɵelementStart(0, \"li\", 4, 5);\n    i0.ɵɵlistener(\"click\", function NzMentionComponent_ng_template_1_li_1_Template_li_click_0_listener() {\n      const restoredCtx = i0.ɵɵrestoreView(_r14);\n      const suggestion_r4 = restoredCtx.$implicit;\n      const ctx_r13 = i0.ɵɵnextContext(2);\n      return ctx_r13.selectSuggestion(suggestion_r4);\n    });\n    i0.ɵɵtemplate(2, NzMentionComponent_ng_template_1_li_1_ng_container_2_Template, 2, 4, \"ng-container\", 6);\n    i0.ɵɵtemplate(3, NzMentionComponent_ng_template_1_li_1_ng_template_3_Template, 1, 1, \"ng-template\", null, 7, i0.ɵɵtemplateRefExtractor);\n    i0.ɵɵelementEnd();\n  }\n\n  if (rf & 2) {\n    const i_r5 = ctx.index;\n\n    const _r8 = i0.ɵɵreference(4);\n\n    const ctx_r2 = i0.ɵɵnextContext(2);\n    i0.ɵɵclassProp(\"focus\", i_r5 === ctx_r2.activeIndex);\n    i0.ɵɵadvance(2);\n    i0.ɵɵproperty(\"ngIf\", ctx_r2.suggestionTemplate)(\"ngIfElse\", _r8);\n  }\n}\n\nfunction NzMentionComponent_ng_template_1_li_2_span_1_Template(rf, ctx) {\n  if (rf & 1) {\n    i0.ɵɵelementStart(0, \"span\");\n    i0.ɵɵelement(1, \"i\", 11);\n    i0.ɵɵelementEnd();\n  }\n}\n\nfunction NzMentionComponent_ng_template_1_li_2_span_2_Template(rf, ctx) {\n  if (rf & 1) {\n    i0.ɵɵelementStart(0, \"span\");\n    i0.ɵɵtext(1);\n    i0.ɵɵelementEnd();\n  }\n\n  if (rf & 2) {\n    const ctx_r16 = i0.ɵɵnextContext(3);\n    i0.ɵɵadvance(1);\n    i0.ɵɵtextInterpolate(ctx_r16.nzNotFoundContent);\n  }\n}\n\nfunction NzMentionComponent_ng_template_1_li_2_Template(rf, ctx) {\n  if (rf & 1) {\n    i0.ɵɵelementStart(0, \"li\", 9);\n    i0.ɵɵtemplate(1, NzMentionComponent_ng_template_1_li_2_span_1_Template, 2, 0, \"span\", 10);\n    i0.ɵɵtemplate(2, NzMentionComponent_ng_template_1_li_2_span_2_Template, 2, 1, \"span\", 10);\n    i0.ɵɵelementEnd();\n  }\n\n  if (rf & 2) {\n    const ctx_r3 = i0.ɵɵnextContext(2);\n    i0.ɵɵadvance(1);\n    i0.ɵɵproperty(\"ngIf\", ctx_r3.nzLoading);\n    i0.ɵɵadvance(1);\n    i0.ɵɵproperty(\"ngIf\", !ctx_r3.nzLoading);\n  }\n}\n\nfunction NzMentionComponent_ng_template_1_Template(rf, ctx) {\n  if (rf & 1) {\n    i0.ɵɵelementStart(0, \"ul\", 1);\n    i0.ɵɵtemplate(1, NzMentionComponent_ng_template_1_li_1_Template, 5, 4, \"li\", 2);\n    i0.ɵɵtemplate(2, NzMentionComponent_ng_template_1_li_2_Template, 3, 2, \"li\", 3);\n    i0.ɵɵelementEnd();\n  }\n\n  if (rf & 2) {\n    const ctx_r1 = i0.ɵɵnextContext();\n    i0.ɵɵadvance(1);\n    i0.ɵɵproperty(\"ngForOf\", ctx_r1.filteredSuggestions);\n    i0.ɵɵadvance(1);\n    i0.ɵɵproperty(\"ngIf\", ctx_r1.filteredSuggestions.length === 0);\n  }\n}\n\nconst _c2 = [\"*\"];\n\nclass NzMentionSuggestionDirective {}\n\nNzMentionSuggestionDirective.ɵfac = function NzMentionSuggestionDirective_Factory(t) {\n  return new (t || NzMentionSuggestionDirective)();\n};\n\nNzMentionSuggestionDirective.ɵdir = /* @__PURE__ */i0.ɵɵdefineDirective({\n  type: NzMentionSuggestionDirective,\n  selectors: [[\"\", \"nzMentionSuggestion\", \"\"]],\n  exportAs: [\"nzMentionSuggestion\"]\n});\n\n(function () {\n  (typeof ngDevMode === \"undefined\" || ngDevMode) && i0.ɵsetClassMetadata(NzMentionSuggestionDirective, [{\n    type: Directive,\n    args: [{\n      selector: '[nzMentionSuggestion]',\n      exportAs: 'nzMentionSuggestion'\n    }]\n  }], null, null);\n})();\n/**\n * Use of this source code is governed by an MIT-style license that can be\n * found in the LICENSE file at https://github.com/NG-ZORRO/ng-zorro-antd/blob/master/LICENSE\n */\n\n\nconst NZ_MENTION_CONFIG = {\n  split: ' '\n};\n/**\n * Use of this source code is governed by an MIT-style license that can be\n * found in the LICENSE file at https://github.com/NG-ZORRO/ng-zorro-antd/blob/master/LICENSE\n */\n\nclass NzMentionService {\n  constructor() {\n    this.triggerChange$ = new Subject();\n  }\n\n  triggerChanged() {\n    return this.triggerChange$.asObservable();\n  }\n\n  registerTrigger(trigger) {\n    if (this.trigger !== trigger) {\n      this.trigger = trigger;\n      this.triggerChange$.next(trigger);\n    }\n  }\n\n  ngOnDestroy() {\n    this.triggerChange$.complete();\n  }\n\n}\n\nNzMentionService.ɵfac = function NzMentionService_Factory(t) {\n  return new (t || NzMentionService)();\n};\n\nNzMentionService.ɵprov = /* @__PURE__ */i0.ɵɵdefineInjectable({\n  token: NzMentionService,\n  factory: NzMentionService.ɵfac\n});\n\n(function () {\n  (typeof ngDevMode === \"undefined\" || ngDevMode) && i0.ɵsetClassMetadata(NzMentionService, [{\n    type: Injectable\n  }], null, null);\n})();\n/**\n * Use of this source code is governed by an MIT-style license that can be\n * found in the LICENSE file at https://github.com/NG-ZORRO/ng-zorro-antd/blob/master/LICENSE\n */\n\n\nconst NZ_MENTION_TRIGGER_ACCESSOR = {\n  provide: NG_VALUE_ACCESSOR,\n  useExisting: forwardRef(() => NzMentionTriggerDirective),\n  multi: true\n};\n\nclass NzMentionTriggerDirective {\n  constructor(el, nzMentionService) {\n    this.el = el;\n    this.nzMentionService = nzMentionService;\n\n    this.onChange = () => {};\n\n    this.onTouched = () => {};\n\n    this.onFocusin = new EventEmitter();\n    this.onBlur = new EventEmitter();\n    this.onInput = new EventEmitter();\n    this.onKeydown = new EventEmitter();\n    this.onClick = new EventEmitter();\n  }\n\n  completeEvents() {\n    this.onFocusin.complete();\n    this.onBlur.complete();\n    this.onInput.complete();\n    this.onKeydown.complete();\n    this.onClick.complete();\n  }\n\n  focus(caretPos) {\n    this.el.nativeElement.focus();\n    this.el.nativeElement.setSelectionRange(caretPos, caretPos);\n  }\n\n  insertMention(mention) {\n    const value = this.el.nativeElement.value;\n    const insertValue = `${mention.mention}${NZ_MENTION_CONFIG.split}`;\n    const newValue = [value.slice(0, mention.startPos + 1), insertValue, value.slice(mention.endPos, value.length)].join('');\n    this.el.nativeElement.value = newValue;\n    this.focus(mention.startPos + insertValue.length + 1);\n    this.onChange(newValue);\n    this.value = newValue;\n  }\n\n  writeValue(value) {\n    this.value = value;\n\n    if (typeof value === 'string') {\n      this.el.nativeElement.value = value;\n    } else {\n      this.el.nativeElement.value = '';\n    }\n  }\n\n  registerOnChange(fn) {\n    this.onChange = fn;\n  }\n\n  registerOnTouched(fn) {\n    this.onTouched = fn;\n  }\n\n  ngAfterViewInit() {\n    this.nzMentionService.registerTrigger(this);\n  }\n\n  ngOnDestroy() {\n    this.completeEvents();\n  }\n\n}\n\nNzMentionTriggerDirective.ɵfac = function NzMentionTriggerDirective_Factory(t) {\n  return new (t || NzMentionTriggerDirective)(i0.ɵɵdirectiveInject(i0.ElementRef), i0.ɵɵdirectiveInject(NzMentionService));\n};\n\nNzMentionTriggerDirective.ɵdir = /* @__PURE__ */i0.ɵɵdefineDirective({\n  type: NzMentionTriggerDirective,\n  selectors: [[\"input\", \"nzMentionTrigger\", \"\"], [\"textarea\", \"nzMentionTrigger\", \"\"]],\n  hostAttrs: [\"autocomplete\", \"off\"],\n  hostBindings: function NzMentionTriggerDirective_HostBindings(rf, ctx) {\n    if (rf & 1) {\n      i0.ɵɵlistener(\"focusin\", function NzMentionTriggerDirective_focusin_HostBindingHandler() {\n        return ctx.onFocusin.emit();\n      })(\"blur\", function NzMentionTriggerDirective_blur_HostBindingHandler() {\n        return ctx.onBlur.emit();\n      })(\"input\", function NzMentionTriggerDirective_input_HostBindingHandler($event) {\n        return ctx.onInput.emit($event);\n      })(\"keydown\", function NzMentionTriggerDirective_keydown_HostBindingHandler($event) {\n        return ctx.onKeydown.emit($event);\n      })(\"click\", function NzMentionTriggerDirective_click_HostBindingHandler($event) {\n        return ctx.onClick.emit($event);\n      });\n    }\n  },\n  exportAs: [\"nzMentionTrigger\"],\n  features: [i0.ɵɵProvidersFeature([NZ_MENTION_TRIGGER_ACCESSOR])]\n});\n\n(function () {\n  (typeof ngDevMode === \"undefined\" || ngDevMode) && i0.ɵsetClassMetadata(NzMentionTriggerDirective, [{\n    type: Directive,\n    args: [{\n      selector: 'input[nzMentionTrigger], textarea[nzMentionTrigger]',\n      exportAs: 'nzMentionTrigger',\n      providers: [NZ_MENTION_TRIGGER_ACCESSOR],\n      host: {\n        autocomplete: 'off',\n        '(focusin)': 'onFocusin.emit()',\n        '(blur)': 'onBlur.emit()',\n        '(input)': 'onInput.emit($event)',\n        '(keydown)': 'onKeydown.emit($event)',\n        '(click)': 'onClick.emit($event)'\n      }\n    }]\n  }], function () {\n    return [{\n      type: i0.ElementRef\n    }, {\n      type: NzMentionService\n    }];\n  }, null);\n})();\n\nclass NzMentionComponent {\n  constructor(ngZone, ngDocument, cdr, overlay, viewContainerRef, nzMentionService) {\n    this.ngZone = ngZone;\n    this.ngDocument = ngDocument;\n    this.cdr = cdr;\n    this.overlay = overlay;\n    this.viewContainerRef = viewContainerRef;\n    this.nzMentionService = nzMentionService;\n\n    this.nzValueWith = value => value;\n\n    this.nzPrefix = '@';\n    this.nzLoading = false;\n    this.nzNotFoundContent = '无匹配结果，轻敲空格完成输入';\n    this.nzPlacement = 'bottom';\n    this.nzSuggestions = [];\n    this.nzOnSelect = new EventEmitter();\n    this.nzOnSearchChange = new EventEmitter();\n    this.isOpen = false;\n    this.filteredSuggestions = [];\n    this.suggestionTemplate = null;\n    this.activeIndex = -1;\n    this.previousValue = null;\n    this.cursorMention = null;\n    this.overlayRef = null;\n  }\n\n  set suggestionChild(value) {\n    if (value) {\n      this.suggestionTemplate = value;\n    }\n  }\n\n  get triggerNativeElement() {\n    return this.trigger.el.nativeElement;\n  }\n\n  get focusItemElement() {\n    var _a;\n\n    const itemArr = (_a = this.items) === null || _a === void 0 ? void 0 : _a.toArray();\n\n    if (itemArr && itemArr[this.activeIndex]) {\n      return itemArr[this.activeIndex].nativeElement;\n    }\n\n    return null;\n  }\n\n  ngOnInit() {\n    this.nzMentionService.triggerChanged().subscribe(trigger => {\n      this.trigger = trigger;\n      this.bindTriggerEvents();\n      this.closeDropdown();\n      this.overlayRef = null;\n    });\n  }\n\n  ngOnChanges(changes) {\n    if (changes.hasOwnProperty('nzSuggestions')) {\n      if (this.isOpen) {\n        this.previousValue = null;\n        this.activeIndex = -1;\n        this.resetDropdown(false);\n      }\n    }\n  }\n\n  ngAfterViewInit() {\n    this.items.changes.pipe(startWith(this.items), switchMap(() => {\n      const items = this.items.toArray(); // Caretaker note: we explicitly should call `subscribe()` within the root zone.\n      // `runOutsideAngular(() => fromEvent(...))` will just create an observable within the root zone,\n      // but `addEventListener` is called when the `fromEvent` is subscribed.\n\n      return new Observable(subscriber => this.ngZone.runOutsideAngular(() => merge(...items.map(item => fromEvent(item.nativeElement, 'mousedown'))).subscribe(subscriber)));\n    })).subscribe(event => {\n      event.preventDefault();\n    });\n  }\n\n  ngOnDestroy() {\n    this.closeDropdown();\n  }\n\n  closeDropdown() {\n    if (this.overlayRef && this.overlayRef.hasAttached()) {\n      this.overlayRef.detach();\n      this.overlayOutsideClickSubscription.unsubscribe();\n      this.isOpen = false;\n      this.cdr.markForCheck();\n    }\n  }\n\n  openDropdown() {\n    this.attachOverlay();\n    this.isOpen = true;\n    this.cdr.markForCheck();\n  }\n\n  getMentions() {\n    return this.trigger ? getMentions(this.trigger.value, this.nzPrefix) : [];\n  }\n\n  selectSuggestion(suggestion) {\n    const value = this.nzValueWith(suggestion);\n    this.trigger.insertMention({\n      mention: value,\n      startPos: this.cursorMentionStart,\n      endPos: this.cursorMentionEnd\n    });\n    this.nzOnSelect.emit(suggestion);\n    this.closeDropdown();\n    this.activeIndex = -1;\n  }\n\n  handleInput(event) {\n    const target = event.target;\n    this.trigger.onChange(target.value);\n    this.trigger.value = target.value;\n    this.resetDropdown();\n  }\n\n  handleKeydown(event) {\n    const keyCode = event.keyCode;\n\n    if (this.isOpen && keyCode === ENTER && this.activeIndex !== -1 && this.filteredSuggestions.length) {\n      this.selectSuggestion(this.filteredSuggestions[this.activeIndex]);\n      event.preventDefault();\n    } else if (keyCode === LEFT_ARROW || keyCode === RIGHT_ARROW) {\n      this.resetDropdown();\n      event.stopPropagation();\n    } else {\n      if (this.isOpen && (keyCode === TAB || keyCode === ESCAPE)) {\n        this.closeDropdown();\n        return;\n      }\n\n      if (this.isOpen && keyCode === UP_ARROW) {\n        this.setPreviousItemActive();\n        event.preventDefault();\n        event.stopPropagation();\n      }\n\n      if (this.isOpen && keyCode === DOWN_ARROW) {\n        this.setNextItemActive();\n        event.preventDefault();\n        event.stopPropagation();\n      }\n    }\n  }\n\n  handleClick() {\n    this.resetDropdown();\n  }\n\n  bindTriggerEvents() {\n    this.trigger.onInput.subscribe(e => this.handleInput(e));\n    this.trigger.onKeydown.subscribe(e => this.handleKeydown(e));\n    this.trigger.onClick.subscribe(() => this.handleClick());\n  }\n\n  suggestionsFilter(value, emit) {\n    const suggestions = value.substring(1);\n    /**\n     * Should always emit (nzOnSearchChange) when value empty\n     *\n     * @[something]... @[empty]... @[empty]\n     *     ^             ^           ^\n     * preValue        preValue  (should emit)\n     */\n\n    if (this.previousValue === value && value !== this.cursorMention[0]) {\n      return;\n    }\n\n    this.previousValue = value;\n\n    if (emit) {\n      this.nzOnSearchChange.emit({\n        value: this.cursorMention.substring(1),\n        prefix: this.cursorMention[0]\n      });\n    }\n\n    const searchValue = suggestions.toLowerCase();\n    this.filteredSuggestions = this.nzSuggestions.filter(suggestion => this.nzValueWith(suggestion).toLowerCase().includes(searchValue));\n  }\n\n  resetDropdown(emit = true) {\n    this.resetCursorMention();\n\n    if (typeof this.cursorMention !== 'string' || !this.canOpen()) {\n      this.closeDropdown();\n      return;\n    }\n\n    this.suggestionsFilter(this.cursorMention, emit);\n    const activeIndex = this.filteredSuggestions.indexOf(this.cursorMention.substring(1));\n    this.activeIndex = activeIndex >= 0 ? activeIndex : 0;\n    this.openDropdown();\n  }\n\n  setNextItemActive() {\n    this.activeIndex = this.activeIndex + 1 <= this.filteredSuggestions.length - 1 ? this.activeIndex + 1 : 0;\n    this.cdr.markForCheck();\n    this.scrollToFocusItem();\n  }\n\n  setPreviousItemActive() {\n    this.activeIndex = this.activeIndex - 1 < 0 ? this.filteredSuggestions.length - 1 : this.activeIndex - 1;\n    this.cdr.markForCheck();\n    this.scrollToFocusItem();\n  }\n\n  scrollToFocusItem() {\n    if (this.focusItemElement) {\n      this.focusItemElement.scrollIntoView({\n        behavior: 'smooth',\n        block: 'center',\n        inline: 'nearest'\n      });\n    }\n  }\n\n  canOpen() {\n    const element = this.triggerNativeElement;\n    return !element.readOnly && !element.disabled;\n  }\n\n  resetCursorMention() {\n    const value = this.triggerNativeElement.value.replace(/[\\r\\n]/g, NZ_MENTION_CONFIG.split) || '';\n    const selectionStart = this.triggerNativeElement.selectionStart;\n    const prefix = typeof this.nzPrefix === 'string' ? [this.nzPrefix] : this.nzPrefix;\n    let i = prefix.length;\n\n    while (i >= 0) {\n      const startPos = value.lastIndexOf(prefix[i], selectionStart);\n      const endPos = value.indexOf(NZ_MENTION_CONFIG.split, selectionStart) > -1 ? value.indexOf(NZ_MENTION_CONFIG.split, selectionStart) : value.length;\n      const mention = value.substring(startPos, endPos);\n\n      if (startPos > 0 && value[startPos - 1] !== NZ_MENTION_CONFIG.split || startPos < 0 || mention.includes(prefix[i], 1) || mention.includes(NZ_MENTION_CONFIG.split)) {\n        this.cursorMention = null;\n        this.cursorMentionStart = -1;\n        this.cursorMentionEnd = -1;\n      } else {\n        this.cursorMention = mention;\n        this.cursorMentionStart = startPos;\n        this.cursorMentionEnd = endPos;\n        return;\n      }\n\n      i--;\n    }\n  }\n\n  updatePositions() {\n    const coordinates = getCaretCoordinates(this.triggerNativeElement, this.cursorMentionStart);\n    const top = coordinates.top - this.triggerNativeElement.getBoundingClientRect().height - this.triggerNativeElement.scrollTop + (this.nzPlacement === 'bottom' ? coordinates.height - 6 : -6);\n    const left = coordinates.left - this.triggerNativeElement.scrollLeft;\n    this.positionStrategy.withDefaultOffsetX(left).withDefaultOffsetY(top);\n\n    if (this.nzPlacement === 'bottom') {\n      this.positionStrategy.withPositions([...DEFAULT_MENTION_BOTTOM_POSITIONS]);\n    }\n\n    if (this.nzPlacement === 'top') {\n      this.positionStrategy.withPositions([...DEFAULT_MENTION_TOP_POSITIONS]);\n    }\n\n    this.positionStrategy.apply();\n  }\n\n  subscribeOverlayOutsideClick() {\n    return merge(this.overlayRef.outsidePointerEvents(), fromEvent(this.ngDocument, 'touchend')).subscribe(event => {\n      var _a;\n\n      const clickTarget = event.target;\n\n      if (this.isOpen && clickTarget !== this.trigger.el.nativeElement && !((_a = this.overlayRef) === null || _a === void 0 ? void 0 : _a.overlayElement.contains(clickTarget))) {\n        this.closeDropdown();\n      }\n    });\n  }\n\n  attachOverlay() {\n    if (!this.overlayRef) {\n      this.portal = new TemplatePortal(this.suggestionsTemp, this.viewContainerRef);\n      this.overlayRef = this.overlay.create(this.getOverlayConfig());\n    }\n\n    if (this.overlayRef && !this.overlayRef.hasAttached()) {\n      this.overlayRef.attach(this.portal);\n      this.overlayOutsideClickSubscription = this.subscribeOverlayOutsideClick();\n    }\n\n    this.updatePositions();\n  }\n\n  getOverlayConfig() {\n    return new OverlayConfig({\n      positionStrategy: this.getOverlayPosition(),\n      scrollStrategy: this.overlay.scrollStrategies.reposition(),\n      disposeOnNavigation: true\n    });\n  }\n\n  getOverlayPosition() {\n    const positions = [new ConnectionPositionPair({\n      originX: 'start',\n      originY: 'bottom'\n    }, {\n      overlayX: 'start',\n      overlayY: 'top'\n    }), new ConnectionPositionPair({\n      originX: 'start',\n      originY: 'top'\n    }, {\n      overlayX: 'start',\n      overlayY: 'bottom'\n    })];\n    this.positionStrategy = this.overlay.position().flexibleConnectedTo(this.trigger.el).withPositions(positions).withFlexibleDimensions(false).withPush(false);\n    return this.positionStrategy;\n  }\n\n}\n\nNzMentionComponent.ɵfac = function NzMentionComponent_Factory(t) {\n  return new (t || NzMentionComponent)(i0.ɵɵdirectiveInject(i0.NgZone), i0.ɵɵdirectiveInject(DOCUMENT, 8), i0.ɵɵdirectiveInject(i0.ChangeDetectorRef), i0.ɵɵdirectiveInject(i1.Overlay), i0.ɵɵdirectiveInject(i0.ViewContainerRef), i0.ɵɵdirectiveInject(NzMentionService));\n};\n\nNzMentionComponent.ɵcmp = /* @__PURE__ */i0.ɵɵdefineComponent({\n  type: NzMentionComponent,\n  selectors: [[\"nz-mention\"]],\n  contentQueries: function NzMentionComponent_ContentQueries(rf, ctx, dirIndex) {\n    if (rf & 1) {\n      i0.ɵɵcontentQuery(dirIndex, NzMentionSuggestionDirective, 5, TemplateRef);\n    }\n\n    if (rf & 2) {\n      let _t;\n\n      i0.ɵɵqueryRefresh(_t = i0.ɵɵloadQuery()) && (ctx.suggestionChild = _t.first);\n    }\n  },\n  viewQuery: function NzMentionComponent_Query(rf, ctx) {\n    if (rf & 1) {\n      i0.ɵɵviewQuery(TemplateRef, 5);\n      i0.ɵɵviewQuery(_c0, 5, ElementRef);\n    }\n\n    if (rf & 2) {\n      let _t;\n\n      i0.ɵɵqueryRefresh(_t = i0.ɵɵloadQuery()) && (ctx.suggestionsTemp = _t.first);\n      i0.ɵɵqueryRefresh(_t = i0.ɵɵloadQuery()) && (ctx.items = _t);\n    }\n  },\n  inputs: {\n    nzValueWith: \"nzValueWith\",\n    nzPrefix: \"nzPrefix\",\n    nzLoading: \"nzLoading\",\n    nzNotFoundContent: \"nzNotFoundContent\",\n    nzPlacement: \"nzPlacement\",\n    nzSuggestions: \"nzSuggestions\"\n  },\n  outputs: {\n    nzOnSelect: \"nzOnSelect\",\n    nzOnSearchChange: \"nzOnSearchChange\"\n  },\n  exportAs: [\"nzMention\"],\n  features: [i0.ɵɵProvidersFeature([NzMentionService]), i0.ɵɵNgOnChangesFeature],\n  ngContentSelectors: _c2,\n  decls: 3,\n  vars: 0,\n  consts: [[\"suggestions\", \"\"], [1, \"ant-mention-dropdown\"], [\"class\", \"ant-mention-dropdown-item\", 3, \"focus\", \"click\", 4, \"ngFor\", \"ngForOf\"], [\"class\", \"ant-mention-dropdown-notfound ant-mention-dropdown-item\", 4, \"ngIf\"], [1, \"ant-mention-dropdown-item\", 3, \"click\"], [\"items\", \"\"], [4, \"ngIf\", \"ngIfElse\"], [\"defaultSuggestion\", \"\"], [4, \"ngTemplateOutlet\", \"ngTemplateOutletContext\"], [1, \"ant-mention-dropdown-notfound\", \"ant-mention-dropdown-item\"], [4, \"ngIf\"], [\"nz-icon\", \"\", \"nzType\", \"loading\"]],\n  template: function NzMentionComponent_Template(rf, ctx) {\n    if (rf & 1) {\n      i0.ɵɵprojectionDef();\n      i0.ɵɵprojection(0);\n      i0.ɵɵtemplate(1, NzMentionComponent_ng_template_1_Template, 3, 2, \"ng-template\", null, 0, i0.ɵɵtemplateRefExtractor);\n    }\n  },\n  directives: [i3.NgForOf, i3.NgIf, i3.NgTemplateOutlet, i4.NzIconDirective],\n  encapsulation: 2,\n  changeDetection: 0\n});\n\n__decorate([InputBoolean()], NzMentionComponent.prototype, \"nzLoading\", void 0);\n\n(function () {\n  (typeof ngDevMode === \"undefined\" || ngDevMode) && i0.ɵsetClassMetadata(NzMentionComponent, [{\n    type: Component,\n    args: [{\n      selector: 'nz-mention',\n      exportAs: 'nzMention',\n      template: `\n    <ng-content></ng-content>\n    <ng-template #suggestions>\n      <ul class=\"ant-mention-dropdown\">\n        <li\n          #items\n          class=\"ant-mention-dropdown-item\"\n          *ngFor=\"let suggestion of filteredSuggestions; let i = index\"\n          [class.focus]=\"i === activeIndex\"\n          (click)=\"selectSuggestion(suggestion)\"\n        >\n          <ng-container *ngIf=\"suggestionTemplate; else defaultSuggestion\">\n            <ng-container *ngTemplateOutlet=\"suggestionTemplate; context: { $implicit: suggestion }\"></ng-container>\n          </ng-container>\n          <ng-template #defaultSuggestion>{{ nzValueWith(suggestion) }}</ng-template>\n        </li>\n        <li class=\"ant-mention-dropdown-notfound ant-mention-dropdown-item\" *ngIf=\"filteredSuggestions.length === 0\">\n          <span *ngIf=\"nzLoading\"><i nz-icon nzType=\"loading\"></i></span>\n          <span *ngIf=\"!nzLoading\">{{ nzNotFoundContent }}</span>\n        </li>\n      </ul>\n    </ng-template>\n  `,\n      preserveWhitespaces: false,\n      changeDetection: ChangeDetectionStrategy.OnPush,\n      providers: [NzMentionService]\n    }]\n  }], function () {\n    return [{\n      type: i0.NgZone\n    }, {\n      type: undefined,\n      decorators: [{\n        type: Optional\n      }, {\n        type: Inject,\n        args: [DOCUMENT]\n      }]\n    }, {\n      type: i0.ChangeDetectorRef\n    }, {\n      type: i1.Overlay\n    }, {\n      type: i0.ViewContainerRef\n    }, {\n      type: NzMentionService\n    }];\n  }, {\n    nzValueWith: [{\n      type: Input\n    }],\n    nzPrefix: [{\n      type: Input\n    }],\n    nzLoading: [{\n      type: Input\n    }],\n    nzNotFoundContent: [{\n      type: Input\n    }],\n    nzPlacement: [{\n      type: Input\n    }],\n    nzSuggestions: [{\n      type: Input\n    }],\n    nzOnSelect: [{\n      type: Output\n    }],\n    nzOnSearchChange: [{\n      type: Output\n    }],\n    suggestionsTemp: [{\n      type: ViewChild,\n      args: [TemplateRef, {\n        static: false\n      }]\n    }],\n    items: [{\n      type: ViewChildren,\n      args: ['items', {\n        read: ElementRef\n      }]\n    }],\n    suggestionChild: [{\n      type: ContentChild,\n      args: [NzMentionSuggestionDirective, {\n        static: false,\n        read: TemplateRef\n      }]\n    }]\n  });\n})();\n/**\n * Use of this source code is governed by an MIT-style license that can be\n * found in the LICENSE file at https://github.com/NG-ZORRO/ng-zorro-antd/blob/master/LICENSE\n */\n\n\nconst COMPONENTS = [NzMentionComponent, NzMentionTriggerDirective, NzMentionSuggestionDirective];\n\nclass NzMentionModule {}\n\nNzMentionModule.ɵfac = function NzMentionModule_Factory(t) {\n  return new (t || NzMentionModule)();\n};\n\nNzMentionModule.ɵmod = /* @__PURE__ */i0.ɵɵdefineNgModule({\n  type: NzMentionModule\n});\nNzMentionModule.ɵinj = /* @__PURE__ */i0.ɵɵdefineInjector({\n  imports: [[BidiModule, CommonModule, FormsModule, OverlayModule, NzIconModule]]\n});\n\n(function () {\n  (typeof ngDevMode === \"undefined\" || ngDevMode) && i0.ɵsetClassMetadata(NzMentionModule, [{\n    type: NgModule,\n    args: [{\n      imports: [BidiModule, CommonModule, FormsModule, OverlayModule, NzIconModule],\n      declarations: [...COMPONENTS],\n      exports: [...COMPONENTS]\n    }]\n  }], null, null);\n})();\n/**\n * Use of this source code is governed by an MIT-style license that can be\n * found in the LICENSE file at https://github.com/NG-ZORRO/ng-zorro-antd/blob/master/LICENSE\n */\n\n/**\n * Generated bundle index. Do not edit.\n */\n\n\nexport { NZ_MENTION_TRIGGER_ACCESSOR, NzMentionComponent, NzMentionModule, NzMentionService, NzMentionSuggestionDirective, NzMentionTriggerDirective };","map":{"version":3,"sources":["/home/tudor/Desktop/Work/Git/Cute/node_modules/ng-zorro-antd/fesm2015/ng-zorro-antd-mention.mjs"],"names":["BidiModule","i1","OverlayConfig","ConnectionPositionPair","OverlayModule","i3","DOCUMENT","CommonModule","i0","Directive","Injectable","forwardRef","EventEmitter","TemplateRef","ElementRef","Component","ChangeDetectionStrategy","Optional","Inject","Input","Output","ViewChild","ViewChildren","ContentChild","NgModule","NG_VALUE_ACCESSOR","FormsModule","i4","NzIconModule","Subject","Observable","merge","fromEvent","__decorate","ENTER","LEFT_ARROW","RIGHT_ARROW","TAB","ESCAPE","UP_ARROW","DOWN_ARROW","TemplatePortal","startWith","switchMap","DEFAULT_MENTION_BOTTOM_POSITIONS","DEFAULT_MENTION_TOP_POSITIONS","getMentions","getCaretCoordinates","InputBoolean","NzMentionSuggestionDirective","ɵfac","ɵdir","type","args","selector","exportAs","NZ_MENTION_CONFIG","split","NzMentionService","constructor","triggerChange$","triggerChanged","asObservable","registerTrigger","trigger","next","ngOnDestroy","complete","ɵprov","NZ_MENTION_TRIGGER_ACCESSOR","provide","useExisting","NzMentionTriggerDirective","multi","el","nzMentionService","onChange","onTouched","onFocusin","onBlur","onInput","onKeydown","onClick","completeEvents","focus","caretPos","nativeElement","setSelectionRange","insertMention","mention","value","insertValue","newValue","slice","startPos","endPos","length","join","writeValue","registerOnChange","fn","registerOnTouched","ngAfterViewInit","providers","host","autocomplete","NzMentionComponent","ngZone","ngDocument","cdr","overlay","viewContainerRef","nzValueWith","nzPrefix","nzLoading","nzNotFoundContent","nzPlacement","nzSuggestions","nzOnSelect","nzOnSearchChange","isOpen","filteredSuggestions","suggestionTemplate","activeIndex","previousValue","cursorMention","overlayRef","suggestionChild","triggerNativeElement","focusItemElement","_a","itemArr","items","toArray","ngOnInit","subscribe","bindTriggerEvents","closeDropdown","ngOnChanges","changes","hasOwnProperty","resetDropdown","pipe","subscriber","runOutsideAngular","map","item","event","preventDefault","hasAttached","detach","overlayOutsideClickSubscription","unsubscribe","markForCheck","openDropdown","attachOverlay","selectSuggestion","suggestion","cursorMentionStart","cursorMentionEnd","emit","handleInput","target","handleKeydown","keyCode","stopPropagation","setPreviousItemActive","setNextItemActive","handleClick","e","suggestionsFilter","suggestions","substring","prefix","searchValue","toLowerCase","filter","includes","resetCursorMention","canOpen","indexOf","scrollToFocusItem","scrollIntoView","behavior","block","inline","element","readOnly","disabled","replace","selectionStart","i","lastIndexOf","updatePositions","coordinates","top","getBoundingClientRect","height","scrollTop","left","scrollLeft","positionStrategy","withDefaultOffsetX","withDefaultOffsetY","withPositions","apply","subscribeOverlayOutsideClick","outsidePointerEvents","clickTarget","overlayElement","contains","portal","suggestionsTemp","create","getOverlayConfig","attach","getOverlayPosition","scrollStrategy","scrollStrategies","reposition","disposeOnNavigation","positions","originX","originY","overlayX","overlayY","position","flexibleConnectedTo","withFlexibleDimensions","withPush","NgZone","ChangeDetectorRef","Overlay","ViewContainerRef","ɵcmp","NgForOf","NgIf","NgTemplateOutlet","NzIconDirective","prototype","template","preserveWhitespaces","changeDetection","OnPush","undefined","decorators","static","read","COMPONENTS","NzMentionModule","ɵmod","ɵinj","imports","declarations","exports"],"mappings":"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","sourcesContent":["import { BidiModule } from '@angular/cdk/bidi';\nimport * as i1 from '@angular/cdk/overlay';\nimport { OverlayConfig, ConnectionPositionPair, OverlayModule } from '@angular/cdk/overlay';\nimport * as i3 from '@angular/common';\nimport { DOCUMENT, CommonModule } from '@angular/common';\nimport * as i0 from '@angular/core';\nimport { Directive, Injectable, forwardRef, EventEmitter, TemplateRef, ElementRef, Component, ChangeDetectionStrategy, Optional, Inject, Input, Output, ViewChild, ViewChildren, ContentChild, NgModule } from '@angular/core';\nimport { NG_VALUE_ACCESSOR, FormsModule } from '@angular/forms';\nimport * as i4 from 'ng-zorro-antd/icon';\nimport { NzIconModule } from 'ng-zorro-antd/icon';\nimport { Subject, Observable, merge, fromEvent } from 'rxjs';\nimport { __decorate } from 'tslib';\nimport { ENTER, LEFT_ARROW, RIGHT_ARROW, TAB, ESCAPE, UP_ARROW, DOWN_ARROW } from '@angular/cdk/keycodes';\nimport { TemplatePortal } from '@angular/cdk/portal';\nimport { startWith, switchMap } from 'rxjs/operators';\nimport { DEFAULT_MENTION_BOTTOM_POSITIONS, DEFAULT_MENTION_TOP_POSITIONS } from 'ng-zorro-antd/core/overlay';\nimport { getMentions, getCaretCoordinates, InputBoolean } from 'ng-zorro-antd/core/util';\n\n/**\n * Use of this source code is governed by an MIT-style license that can be\n * found in the LICENSE file at https://github.com/NG-ZORRO/ng-zorro-antd/blob/master/LICENSE\n */\nclass NzMentionSuggestionDirective {\n}\nNzMentionSuggestionDirective.ɵfac = i0.ɵɵngDeclareFactory({ minVersion: \"12.0.0\", version: \"13.1.2\", ngImport: i0, type: NzMentionSuggestionDirective, deps: [], target: i0.ɵɵFactoryTarget.Directive });\nNzMentionSuggestionDirective.ɵdir = i0.ɵɵngDeclareDirective({ minVersion: \"12.0.0\", version: \"13.1.2\", type: NzMentionSuggestionDirective, selector: \"[nzMentionSuggestion]\", exportAs: [\"nzMentionSuggestion\"], ngImport: i0 });\ni0.ɵɵngDeclareClassMetadata({ minVersion: \"12.0.0\", version: \"13.1.2\", ngImport: i0, type: NzMentionSuggestionDirective, decorators: [{\n            type: Directive,\n            args: [{\n                    selector: '[nzMentionSuggestion]',\n                    exportAs: 'nzMentionSuggestion'\n                }]\n        }] });\n\n/**\n * Use of this source code is governed by an MIT-style license that can be\n * found in the LICENSE file at https://github.com/NG-ZORRO/ng-zorro-antd/blob/master/LICENSE\n */\nconst NZ_MENTION_CONFIG = {\n    split: ' '\n};\n\n/**\n * Use of this source code is governed by an MIT-style license that can be\n * found in the LICENSE file at https://github.com/NG-ZORRO/ng-zorro-antd/blob/master/LICENSE\n */\nclass NzMentionService {\n    constructor() {\n        this.triggerChange$ = new Subject();\n    }\n    triggerChanged() {\n        return this.triggerChange$.asObservable();\n    }\n    registerTrigger(trigger) {\n        if (this.trigger !== trigger) {\n            this.trigger = trigger;\n            this.triggerChange$.next(trigger);\n        }\n    }\n    ngOnDestroy() {\n        this.triggerChange$.complete();\n    }\n}\nNzMentionService.ɵfac = i0.ɵɵngDeclareFactory({ minVersion: \"12.0.0\", version: \"13.1.2\", ngImport: i0, type: NzMentionService, deps: [], target: i0.ɵɵFactoryTarget.Injectable });\nNzMentionService.ɵprov = i0.ɵɵngDeclareInjectable({ minVersion: \"12.0.0\", version: \"13.1.2\", ngImport: i0, type: NzMentionService });\ni0.ɵɵngDeclareClassMetadata({ minVersion: \"12.0.0\", version: \"13.1.2\", ngImport: i0, type: NzMentionService, decorators: [{\n            type: Injectable\n        }] });\n\n/**\n * Use of this source code is governed by an MIT-style license that can be\n * found in the LICENSE file at https://github.com/NG-ZORRO/ng-zorro-antd/blob/master/LICENSE\n */\nconst NZ_MENTION_TRIGGER_ACCESSOR = {\n    provide: NG_VALUE_ACCESSOR,\n    useExisting: forwardRef(() => NzMentionTriggerDirective),\n    multi: true\n};\nclass NzMentionTriggerDirective {\n    constructor(el, nzMentionService) {\n        this.el = el;\n        this.nzMentionService = nzMentionService;\n        this.onChange = () => { };\n        this.onTouched = () => { };\n        this.onFocusin = new EventEmitter();\n        this.onBlur = new EventEmitter();\n        this.onInput = new EventEmitter();\n        this.onKeydown = new EventEmitter();\n        this.onClick = new EventEmitter();\n    }\n    completeEvents() {\n        this.onFocusin.complete();\n        this.onBlur.complete();\n        this.onInput.complete();\n        this.onKeydown.complete();\n        this.onClick.complete();\n    }\n    focus(caretPos) {\n        this.el.nativeElement.focus();\n        this.el.nativeElement.setSelectionRange(caretPos, caretPos);\n    }\n    insertMention(mention) {\n        const value = this.el.nativeElement.value;\n        const insertValue = `${mention.mention}${NZ_MENTION_CONFIG.split}`;\n        const newValue = [\n            value.slice(0, mention.startPos + 1),\n            insertValue,\n            value.slice(mention.endPos, value.length)\n        ].join('');\n        this.el.nativeElement.value = newValue;\n        this.focus(mention.startPos + insertValue.length + 1);\n        this.onChange(newValue);\n        this.value = newValue;\n    }\n    writeValue(value) {\n        this.value = value;\n        if (typeof value === 'string') {\n            this.el.nativeElement.value = value;\n        }\n        else {\n            this.el.nativeElement.value = '';\n        }\n    }\n    registerOnChange(fn) {\n        this.onChange = fn;\n    }\n    registerOnTouched(fn) {\n        this.onTouched = fn;\n    }\n    ngAfterViewInit() {\n        this.nzMentionService.registerTrigger(this);\n    }\n    ngOnDestroy() {\n        this.completeEvents();\n    }\n}\nNzMentionTriggerDirective.ɵfac = i0.ɵɵngDeclareFactory({ minVersion: \"12.0.0\", version: \"13.1.2\", ngImport: i0, type: NzMentionTriggerDirective, deps: [{ token: i0.ElementRef }, { token: NzMentionService }], target: i0.ɵɵFactoryTarget.Directive });\nNzMentionTriggerDirective.ɵdir = i0.ɵɵngDeclareDirective({ minVersion: \"12.0.0\", version: \"13.1.2\", type: NzMentionTriggerDirective, selector: \"input[nzMentionTrigger], textarea[nzMentionTrigger]\", host: { attributes: { \"autocomplete\": \"off\" }, listeners: { \"focusin\": \"onFocusin.emit()\", \"blur\": \"onBlur.emit()\", \"input\": \"onInput.emit($event)\", \"keydown\": \"onKeydown.emit($event)\", \"click\": \"onClick.emit($event)\" } }, providers: [NZ_MENTION_TRIGGER_ACCESSOR], exportAs: [\"nzMentionTrigger\"], ngImport: i0 });\ni0.ɵɵngDeclareClassMetadata({ minVersion: \"12.0.0\", version: \"13.1.2\", ngImport: i0, type: NzMentionTriggerDirective, decorators: [{\n            type: Directive,\n            args: [{\n                    selector: 'input[nzMentionTrigger], textarea[nzMentionTrigger]',\n                    exportAs: 'nzMentionTrigger',\n                    providers: [NZ_MENTION_TRIGGER_ACCESSOR],\n                    host: {\n                        autocomplete: 'off',\n                        '(focusin)': 'onFocusin.emit()',\n                        '(blur)': 'onBlur.emit()',\n                        '(input)': 'onInput.emit($event)',\n                        '(keydown)': 'onKeydown.emit($event)',\n                        '(click)': 'onClick.emit($event)'\n                    }\n                }]\n        }], ctorParameters: function () { return [{ type: i0.ElementRef }, { type: NzMentionService }]; } });\n\nclass NzMentionComponent {\n    constructor(ngZone, ngDocument, cdr, overlay, viewContainerRef, nzMentionService) {\n        this.ngZone = ngZone;\n        this.ngDocument = ngDocument;\n        this.cdr = cdr;\n        this.overlay = overlay;\n        this.viewContainerRef = viewContainerRef;\n        this.nzMentionService = nzMentionService;\n        this.nzValueWith = value => value;\n        this.nzPrefix = '@';\n        this.nzLoading = false;\n        this.nzNotFoundContent = '无匹配结果，轻敲空格完成输入';\n        this.nzPlacement = 'bottom';\n        this.nzSuggestions = [];\n        this.nzOnSelect = new EventEmitter();\n        this.nzOnSearchChange = new EventEmitter();\n        this.isOpen = false;\n        this.filteredSuggestions = [];\n        this.suggestionTemplate = null;\n        this.activeIndex = -1;\n        this.previousValue = null;\n        this.cursorMention = null;\n        this.overlayRef = null;\n    }\n    set suggestionChild(value) {\n        if (value) {\n            this.suggestionTemplate = value;\n        }\n    }\n    get triggerNativeElement() {\n        return this.trigger.el.nativeElement;\n    }\n    get focusItemElement() {\n        var _a;\n        const itemArr = (_a = this.items) === null || _a === void 0 ? void 0 : _a.toArray();\n        if (itemArr && itemArr[this.activeIndex]) {\n            return itemArr[this.activeIndex].nativeElement;\n        }\n        return null;\n    }\n    ngOnInit() {\n        this.nzMentionService.triggerChanged().subscribe(trigger => {\n            this.trigger = trigger;\n            this.bindTriggerEvents();\n            this.closeDropdown();\n            this.overlayRef = null;\n        });\n    }\n    ngOnChanges(changes) {\n        if (changes.hasOwnProperty('nzSuggestions')) {\n            if (this.isOpen) {\n                this.previousValue = null;\n                this.activeIndex = -1;\n                this.resetDropdown(false);\n            }\n        }\n    }\n    ngAfterViewInit() {\n        this.items.changes\n            .pipe(startWith(this.items), switchMap(() => {\n            const items = this.items.toArray();\n            // Caretaker note: we explicitly should call `subscribe()` within the root zone.\n            // `runOutsideAngular(() => fromEvent(...))` will just create an observable within the root zone,\n            // but `addEventListener` is called when the `fromEvent` is subscribed.\n            return new Observable(subscriber => this.ngZone.runOutsideAngular(() => merge(...items.map(item => fromEvent(item.nativeElement, 'mousedown'))).subscribe(subscriber)));\n        }))\n            .subscribe(event => {\n            event.preventDefault();\n        });\n    }\n    ngOnDestroy() {\n        this.closeDropdown();\n    }\n    closeDropdown() {\n        if (this.overlayRef && this.overlayRef.hasAttached()) {\n            this.overlayRef.detach();\n            this.overlayOutsideClickSubscription.unsubscribe();\n            this.isOpen = false;\n            this.cdr.markForCheck();\n        }\n    }\n    openDropdown() {\n        this.attachOverlay();\n        this.isOpen = true;\n        this.cdr.markForCheck();\n    }\n    getMentions() {\n        return this.trigger ? getMentions(this.trigger.value, this.nzPrefix) : [];\n    }\n    selectSuggestion(suggestion) {\n        const value = this.nzValueWith(suggestion);\n        this.trigger.insertMention({\n            mention: value,\n            startPos: this.cursorMentionStart,\n            endPos: this.cursorMentionEnd\n        });\n        this.nzOnSelect.emit(suggestion);\n        this.closeDropdown();\n        this.activeIndex = -1;\n    }\n    handleInput(event) {\n        const target = event.target;\n        this.trigger.onChange(target.value);\n        this.trigger.value = target.value;\n        this.resetDropdown();\n    }\n    handleKeydown(event) {\n        const keyCode = event.keyCode;\n        if (this.isOpen && keyCode === ENTER && this.activeIndex !== -1 && this.filteredSuggestions.length) {\n            this.selectSuggestion(this.filteredSuggestions[this.activeIndex]);\n            event.preventDefault();\n        }\n        else if (keyCode === LEFT_ARROW || keyCode === RIGHT_ARROW) {\n            this.resetDropdown();\n            event.stopPropagation();\n        }\n        else {\n            if (this.isOpen && (keyCode === TAB || keyCode === ESCAPE)) {\n                this.closeDropdown();\n                return;\n            }\n            if (this.isOpen && keyCode === UP_ARROW) {\n                this.setPreviousItemActive();\n                event.preventDefault();\n                event.stopPropagation();\n            }\n            if (this.isOpen && keyCode === DOWN_ARROW) {\n                this.setNextItemActive();\n                event.preventDefault();\n                event.stopPropagation();\n            }\n        }\n    }\n    handleClick() {\n        this.resetDropdown();\n    }\n    bindTriggerEvents() {\n        this.trigger.onInput.subscribe((e) => this.handleInput(e));\n        this.trigger.onKeydown.subscribe((e) => this.handleKeydown(e));\n        this.trigger.onClick.subscribe(() => this.handleClick());\n    }\n    suggestionsFilter(value, emit) {\n        const suggestions = value.substring(1);\n        /**\n         * Should always emit (nzOnSearchChange) when value empty\n         *\n         * @[something]... @[empty]... @[empty]\n         *     ^             ^           ^\n         * preValue        preValue  (should emit)\n         */\n        if (this.previousValue === value && value !== this.cursorMention[0]) {\n            return;\n        }\n        this.previousValue = value;\n        if (emit) {\n            this.nzOnSearchChange.emit({\n                value: this.cursorMention.substring(1),\n                prefix: this.cursorMention[0]\n            });\n        }\n        const searchValue = suggestions.toLowerCase();\n        this.filteredSuggestions = this.nzSuggestions.filter(suggestion => this.nzValueWith(suggestion).toLowerCase().includes(searchValue));\n    }\n    resetDropdown(emit = true) {\n        this.resetCursorMention();\n        if (typeof this.cursorMention !== 'string' || !this.canOpen()) {\n            this.closeDropdown();\n            return;\n        }\n        this.suggestionsFilter(this.cursorMention, emit);\n        const activeIndex = this.filteredSuggestions.indexOf(this.cursorMention.substring(1));\n        this.activeIndex = activeIndex >= 0 ? activeIndex : 0;\n        this.openDropdown();\n    }\n    setNextItemActive() {\n        this.activeIndex = this.activeIndex + 1 <= this.filteredSuggestions.length - 1 ? this.activeIndex + 1 : 0;\n        this.cdr.markForCheck();\n        this.scrollToFocusItem();\n    }\n    setPreviousItemActive() {\n        this.activeIndex = this.activeIndex - 1 < 0 ? this.filteredSuggestions.length - 1 : this.activeIndex - 1;\n        this.cdr.markForCheck();\n        this.scrollToFocusItem();\n    }\n    scrollToFocusItem() {\n        if (this.focusItemElement) {\n            this.focusItemElement.scrollIntoView({ behavior: 'smooth', block: 'center', inline: 'nearest' });\n        }\n    }\n    canOpen() {\n        const element = this.triggerNativeElement;\n        return !element.readOnly && !element.disabled;\n    }\n    resetCursorMention() {\n        const value = this.triggerNativeElement.value.replace(/[\\r\\n]/g, NZ_MENTION_CONFIG.split) || '';\n        const selectionStart = this.triggerNativeElement.selectionStart;\n        const prefix = typeof this.nzPrefix === 'string' ? [this.nzPrefix] : this.nzPrefix;\n        let i = prefix.length;\n        while (i >= 0) {\n            const startPos = value.lastIndexOf(prefix[i], selectionStart);\n            const endPos = value.indexOf(NZ_MENTION_CONFIG.split, selectionStart) > -1\n                ? value.indexOf(NZ_MENTION_CONFIG.split, selectionStart)\n                : value.length;\n            const mention = value.substring(startPos, endPos);\n            if ((startPos > 0 && value[startPos - 1] !== NZ_MENTION_CONFIG.split) ||\n                startPos < 0 ||\n                mention.includes(prefix[i], 1) ||\n                mention.includes(NZ_MENTION_CONFIG.split)) {\n                this.cursorMention = null;\n                this.cursorMentionStart = -1;\n                this.cursorMentionEnd = -1;\n            }\n            else {\n                this.cursorMention = mention;\n                this.cursorMentionStart = startPos;\n                this.cursorMentionEnd = endPos;\n                return;\n            }\n            i--;\n        }\n    }\n    updatePositions() {\n        const coordinates = getCaretCoordinates(this.triggerNativeElement, this.cursorMentionStart);\n        const top = coordinates.top -\n            this.triggerNativeElement.getBoundingClientRect().height -\n            this.triggerNativeElement.scrollTop +\n            (this.nzPlacement === 'bottom' ? coordinates.height - 6 : -6);\n        const left = coordinates.left - this.triggerNativeElement.scrollLeft;\n        this.positionStrategy.withDefaultOffsetX(left).withDefaultOffsetY(top);\n        if (this.nzPlacement === 'bottom') {\n            this.positionStrategy.withPositions([...DEFAULT_MENTION_BOTTOM_POSITIONS]);\n        }\n        if (this.nzPlacement === 'top') {\n            this.positionStrategy.withPositions([...DEFAULT_MENTION_TOP_POSITIONS]);\n        }\n        this.positionStrategy.apply();\n    }\n    subscribeOverlayOutsideClick() {\n        return merge(this.overlayRef.outsidePointerEvents(), fromEvent(this.ngDocument, 'touchend')).subscribe((event) => {\n            var _a;\n            const clickTarget = event.target;\n            if (this.isOpen &&\n                clickTarget !== this.trigger.el.nativeElement &&\n                !((_a = this.overlayRef) === null || _a === void 0 ? void 0 : _a.overlayElement.contains(clickTarget))) {\n                this.closeDropdown();\n            }\n        });\n    }\n    attachOverlay() {\n        if (!this.overlayRef) {\n            this.portal = new TemplatePortal(this.suggestionsTemp, this.viewContainerRef);\n            this.overlayRef = this.overlay.create(this.getOverlayConfig());\n        }\n        if (this.overlayRef && !this.overlayRef.hasAttached()) {\n            this.overlayRef.attach(this.portal);\n            this.overlayOutsideClickSubscription = this.subscribeOverlayOutsideClick();\n        }\n        this.updatePositions();\n    }\n    getOverlayConfig() {\n        return new OverlayConfig({\n            positionStrategy: this.getOverlayPosition(),\n            scrollStrategy: this.overlay.scrollStrategies.reposition(),\n            disposeOnNavigation: true\n        });\n    }\n    getOverlayPosition() {\n        const positions = [\n            new ConnectionPositionPair({ originX: 'start', originY: 'bottom' }, { overlayX: 'start', overlayY: 'top' }),\n            new ConnectionPositionPair({ originX: 'start', originY: 'top' }, { overlayX: 'start', overlayY: 'bottom' })\n        ];\n        this.positionStrategy = this.overlay\n            .position()\n            .flexibleConnectedTo(this.trigger.el)\n            .withPositions(positions)\n            .withFlexibleDimensions(false)\n            .withPush(false);\n        return this.positionStrategy;\n    }\n}\nNzMentionComponent.ɵfac = i0.ɵɵngDeclareFactory({ minVersion: \"12.0.0\", version: \"13.1.2\", ngImport: i0, type: NzMentionComponent, deps: [{ token: i0.NgZone }, { token: DOCUMENT, optional: true }, { token: i0.ChangeDetectorRef }, { token: i1.Overlay }, { token: i0.ViewContainerRef }, { token: NzMentionService }], target: i0.ɵɵFactoryTarget.Component });\nNzMentionComponent.ɵcmp = i0.ɵɵngDeclareComponent({ minVersion: \"12.0.0\", version: \"13.1.2\", type: NzMentionComponent, selector: \"nz-mention\", inputs: { nzValueWith: \"nzValueWith\", nzPrefix: \"nzPrefix\", nzLoading: \"nzLoading\", nzNotFoundContent: \"nzNotFoundContent\", nzPlacement: \"nzPlacement\", nzSuggestions: \"nzSuggestions\" }, outputs: { nzOnSelect: \"nzOnSelect\", nzOnSearchChange: \"nzOnSearchChange\" }, providers: [NzMentionService], queries: [{ propertyName: \"suggestionChild\", first: true, predicate: NzMentionSuggestionDirective, descendants: true, read: TemplateRef }], viewQueries: [{ propertyName: \"suggestionsTemp\", first: true, predicate: TemplateRef, descendants: true }, { propertyName: \"items\", predicate: [\"items\"], descendants: true, read: ElementRef }], exportAs: [\"nzMention\"], usesOnChanges: true, ngImport: i0, template: `\n    <ng-content></ng-content>\n    <ng-template #suggestions>\n      <ul class=\"ant-mention-dropdown\">\n        <li\n          #items\n          class=\"ant-mention-dropdown-item\"\n          *ngFor=\"let suggestion of filteredSuggestions; let i = index\"\n          [class.focus]=\"i === activeIndex\"\n          (click)=\"selectSuggestion(suggestion)\"\n        >\n          <ng-container *ngIf=\"suggestionTemplate; else defaultSuggestion\">\n            <ng-container *ngTemplateOutlet=\"suggestionTemplate; context: { $implicit: suggestion }\"></ng-container>\n          </ng-container>\n          <ng-template #defaultSuggestion>{{ nzValueWith(suggestion) }}</ng-template>\n        </li>\n        <li class=\"ant-mention-dropdown-notfound ant-mention-dropdown-item\" *ngIf=\"filteredSuggestions.length === 0\">\n          <span *ngIf=\"nzLoading\"><i nz-icon nzType=\"loading\"></i></span>\n          <span *ngIf=\"!nzLoading\">{{ nzNotFoundContent }}</span>\n        </li>\n      </ul>\n    </ng-template>\n  `, isInline: true, directives: [{ type: i3.NgForOf, selector: \"[ngFor][ngForOf]\", inputs: [\"ngForOf\", \"ngForTrackBy\", \"ngForTemplate\"] }, { type: i3.NgIf, selector: \"[ngIf]\", inputs: [\"ngIf\", \"ngIfThen\", \"ngIfElse\"] }, { type: i3.NgTemplateOutlet, selector: \"[ngTemplateOutlet]\", inputs: [\"ngTemplateOutletContext\", \"ngTemplateOutlet\"] }, { type: i4.NzIconDirective, selector: \"[nz-icon]\", inputs: [\"nzSpin\", \"nzRotate\", \"nzType\", \"nzTheme\", \"nzTwotoneColor\", \"nzIconfont\"], exportAs: [\"nzIcon\"] }], changeDetection: i0.ChangeDetectionStrategy.OnPush });\n__decorate([\n    InputBoolean()\n], NzMentionComponent.prototype, \"nzLoading\", void 0);\ni0.ɵɵngDeclareClassMetadata({ minVersion: \"12.0.0\", version: \"13.1.2\", ngImport: i0, type: NzMentionComponent, decorators: [{\n            type: Component,\n            args: [{\n                    selector: 'nz-mention',\n                    exportAs: 'nzMention',\n                    template: `\n    <ng-content></ng-content>\n    <ng-template #suggestions>\n      <ul class=\"ant-mention-dropdown\">\n        <li\n          #items\n          class=\"ant-mention-dropdown-item\"\n          *ngFor=\"let suggestion of filteredSuggestions; let i = index\"\n          [class.focus]=\"i === activeIndex\"\n          (click)=\"selectSuggestion(suggestion)\"\n        >\n          <ng-container *ngIf=\"suggestionTemplate; else defaultSuggestion\">\n            <ng-container *ngTemplateOutlet=\"suggestionTemplate; context: { $implicit: suggestion }\"></ng-container>\n          </ng-container>\n          <ng-template #defaultSuggestion>{{ nzValueWith(suggestion) }}</ng-template>\n        </li>\n        <li class=\"ant-mention-dropdown-notfound ant-mention-dropdown-item\" *ngIf=\"filteredSuggestions.length === 0\">\n          <span *ngIf=\"nzLoading\"><i nz-icon nzType=\"loading\"></i></span>\n          <span *ngIf=\"!nzLoading\">{{ nzNotFoundContent }}</span>\n        </li>\n      </ul>\n    </ng-template>\n  `,\n                    preserveWhitespaces: false,\n                    changeDetection: ChangeDetectionStrategy.OnPush,\n                    providers: [NzMentionService]\n                }]\n        }], ctorParameters: function () {\n        return [{ type: i0.NgZone }, { type: undefined, decorators: [{\n                        type: Optional\n                    }, {\n                        type: Inject,\n                        args: [DOCUMENT]\n                    }] }, { type: i0.ChangeDetectorRef }, { type: i1.Overlay }, { type: i0.ViewContainerRef }, { type: NzMentionService }];\n    }, propDecorators: { nzValueWith: [{\n                type: Input\n            }], nzPrefix: [{\n                type: Input\n            }], nzLoading: [{\n                type: Input\n            }], nzNotFoundContent: [{\n                type: Input\n            }], nzPlacement: [{\n                type: Input\n            }], nzSuggestions: [{\n                type: Input\n            }], nzOnSelect: [{\n                type: Output\n            }], nzOnSearchChange: [{\n                type: Output\n            }], suggestionsTemp: [{\n                type: ViewChild,\n                args: [TemplateRef, { static: false }]\n            }], items: [{\n                type: ViewChildren,\n                args: ['items', { read: ElementRef }]\n            }], suggestionChild: [{\n                type: ContentChild,\n                args: [NzMentionSuggestionDirective, { static: false, read: TemplateRef }]\n            }] } });\n\n/**\n * Use of this source code is governed by an MIT-style license that can be\n * found in the LICENSE file at https://github.com/NG-ZORRO/ng-zorro-antd/blob/master/LICENSE\n */\nconst COMPONENTS = [NzMentionComponent, NzMentionTriggerDirective, NzMentionSuggestionDirective];\nclass NzMentionModule {\n}\nNzMentionModule.ɵfac = i0.ɵɵngDeclareFactory({ minVersion: \"12.0.0\", version: \"13.1.2\", ngImport: i0, type: NzMentionModule, deps: [], target: i0.ɵɵFactoryTarget.NgModule });\nNzMentionModule.ɵmod = i0.ɵɵngDeclareNgModule({ minVersion: \"12.0.0\", version: \"13.1.2\", ngImport: i0, type: NzMentionModule, declarations: [NzMentionComponent, NzMentionTriggerDirective, NzMentionSuggestionDirective], imports: [BidiModule, CommonModule, FormsModule, OverlayModule, NzIconModule], exports: [NzMentionComponent, NzMentionTriggerDirective, NzMentionSuggestionDirective] });\nNzMentionModule.ɵinj = i0.ɵɵngDeclareInjector({ minVersion: \"12.0.0\", version: \"13.1.2\", ngImport: i0, type: NzMentionModule, imports: [[BidiModule, CommonModule, FormsModule, OverlayModule, NzIconModule]] });\ni0.ɵɵngDeclareClassMetadata({ minVersion: \"12.0.0\", version: \"13.1.2\", ngImport: i0, type: NzMentionModule, decorators: [{\n            type: NgModule,\n            args: [{\n                    imports: [BidiModule, CommonModule, FormsModule, OverlayModule, NzIconModule],\n                    declarations: [...COMPONENTS],\n                    exports: [...COMPONENTS]\n                }]\n        }] });\n\n/**\n * Use of this source code is governed by an MIT-style license that can be\n * found in the LICENSE file at https://github.com/NG-ZORRO/ng-zorro-antd/blob/master/LICENSE\n */\n\n/**\n * Generated bundle index. Do not edit.\n */\n\nexport { NZ_MENTION_TRIGGER_ACCESSOR, NzMentionComponent, NzMentionModule, NzMentionService, NzMentionSuggestionDirective, NzMentionTriggerDirective };\n"]},"metadata":{},"sourceType":"module"}